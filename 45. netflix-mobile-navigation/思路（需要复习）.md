这篇实现的是奈非的侧边菜单的效果，以为挺简单，结果调了半天才调好。总的来说这篇很有收获，惯例的记下思路。

**多侧边栏的动画**
可以看看这个项目的 live demo，侧边栏有 3 个，其中一个放菜单，另外两个作为背景。
打开的时候侧边栏显示的顺序是 黑显示完 -> 红显示完 -> 白。关闭的时候则相反。显然这里可以通过 transition-delay 控制，实际上我的代码也是这样写的，不过是最 nt 的没考虑复杂性的代码。

另外这里比较头疼的一点是两个背景侧边栏如何显示。本想放到 menu 当子元素的，然而因为背景侧边栏有 z-index 的重叠，所以并不能放进去（如果放了内容就会被挡住，解决方法是把内容包一层）

**改进**
看了教程的代码，感觉动画延时方面还是可以改进的，具体来说：
当 nav active 的时候，颠倒动画延时即可。
另外教程中没有涉及到 z-index 的问题，这可能是自己打的一个小收获。

**z-index的理解**
[StackOverflow](https://stackoverflow.com/questions/5218927/z-index-not-working-with-fixed-positioning)
建议看这篇：
[z-index & stacking context](https://philipwalton.com/articles/what-no-one-told-you-about-z-index/)
首先我们需要知道，z-index 只有在元素开启定位时（这里的定位指除 position: static 之外的所有定位值）才会生效。然后我们需要知道，一个元素开启定位后，它就会显示在所有没开启定位元素的上面（如果这个元素下面有没开启定位的元素的话）。而元素开启定位后，会产生一个**堆叠上下文**，z-index 设置的是**同级堆叠上下文**的元素的显示行为。这里可以认为**如果元素之间是同级的话，那么它们创建的堆叠上下文就是同级的。**而对于堆叠上下文的显示行为，其实就很简单了—— z-index 大的堆叠上下文的元素会在 z-index 小的同级堆叠上下文上面——这点符合我们对 z-index 最初的认识。另外，这里还要解决一个问题：不同级的元素之间的堆叠上下文是怎么计算的？很简单，看的是他们第一个具有同级堆叠上下文元素的 z-index（最顶级的开启堆叠上下文的元素是 html 元素）。

**除了定位，还有什么方法能开启堆叠上下文**
1. opacity < 1
2. transforms 等



讲了这么多，来看代码：
```html
<!-- 两个同级的 div -->
<div class="box b1">
  <!-- 第一个含有一个 p 元素 -->
  <p>hello</p>
</div>
<div class="box b2"></div>
```
如果现在给 box 类开启定位，那么就会创建两个堆叠上下文：
```css
.box {
    position: absolute;
    left: 0;
    top: 0;
    width: 100px;
    height: 100px;
}

.b1 {
    background: red;
}

.b2 {
    background: black;
}
```
现在这两个div会重叠在一起，且第二个div会挡住第一个div，这是没设置 z-index 的默认行为。现在个 .b2 一个偏移，然后设置 b1 的 z-index:
```css
.b2 {
    left: 50px;
}

.b1 {
    z-index: 1;
}
```
那么 b1 的 100px 会完全显示，而 b2 的 50px 会被 b1 的挡住。注意这里两个元素是同级的，故它们的堆叠上下文也是同级的，而 b2 的堆叠上下文的 z-index 没 b1 的大，故 b2 会被挡住。
现在给 b1 的 p 设置定位和 z-index：
```css
.b1 p {
  position: absolute;
  z-index: -100;
}
```
现在 p 也开启了堆叠上下文，然而设置 z-index 并不会让 p 被 b1 覆盖（挡住），这是因为 p 的堆叠上下文在 b1 内，而堆叠上下文永远是同级比较的，而 p 这里没有同级的元素，所以设置的 z-index 实际并不会有什么效果。
如果现在设置 b2 的 z-index 为 1000，然后让 b2 覆盖 b1，会发生什么呢？
```css
.b2 {
    z-index: 1000;
    left: 0;
}
```
可以看到 b2 覆盖了 b1，且 b1 里面的 p 也被覆盖了（可以试试调整 p 的 z-index，并不会影响结果），这就是堆叠上下文同级比较的另一个特点：**级别低的堆叠上下文会被同级级别高的覆盖，且其中的子元素也会被覆盖，无论这个子元素 z-index 多大**

**开启定位的元素需要注意的地方**
1. 开启定位的元素会脱离文档流，这个应该都没问题
2. 开启定位的元素会开启堆叠上下文
3. **开启定位的元素的背景会消失** 因为忘了这点导致调了半天，而实际上本该被覆盖的那个元素是因为覆盖它的元素背景变透明了而显示出来的
